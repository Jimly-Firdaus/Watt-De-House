image: python:3.9-slim-buster

stages:
  - test

variables:
  PYTHONPATH: "$PYTHONPATH:$CI_PROJECT_DIR/src"

before_script:
  - apt-get update && apt-get install -y python3-pip libgl1-mesa-glx libxcb1 libx11-xcb1 libxcb-icccm4 libxcb-image0 libxcb-keysyms1 libxcb-randr0 libxcb-render-util0 libfontconfig1 libxcb-util0
  - echo "deb http://deb.debian.org/debian buster-backports main" > /etc/apt/sources.list.d/backports.list
  - apt-get update && apt-get -t buster-backports install -y libxcb-util1
  - echo "Python 3, pip, and dependencies installed"
  - pip3 install PyQt5
  - echo "PyQt5 installed"

run-tests:
  tags:
    - docker-runner
  stage: test
  script:
    - export QT_DEBUG_PLUGINS=1
    - python3 -m unittest discover test
  only:
    - merge_requests
    - main
    - dev
    - feature/gui